<!DOCTYPE html>
<html lang="tr">
<head>
    <%- include("../partials/meta") %>
    <title>ÜRÜN MALZEME STOKLARI</title>

    <style>
      .item-list:hover{
        background-color: #3585fd !important;
        color: white !important;
        cursor: pointer;
      }
    </style>

</head>
<body class="bg-dark">
    <%- include("../partials/nav") %>

    <main>

     


      <div class="showScreen container-xl d-flex justify-content-center flex-wrap vw-100 vh-100 gap-3 mt-1 mb-4 ">

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">TRC60</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% trc60StockCard.forEach(trc60 => { %>
                  <div class="d-flex justify-content-between  bg-primary mb-1 item-list">
                    <li class="list-group-item bg-primary text-white mb-1 p-2 item-list"><%= trc60.urun_malzeme_adi %></li>
                    <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= trc60.urun_malzeme_adet %></strong> PCS </li>
                  </div>
                    
              <% }) %>

            </ol>
           
          </div>
        </div>

        

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">TRC01</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% trc01StockCard.forEach(trc01 => { %>
                   
                    <div class="d-flex justify-content-between bg-primary mb-1  item-list">
                      <li class="list-group-item bg-primary text-white mb-1 p-2  item-list"><%= trc01.urun_malzeme_adi %></li>
                      <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= trc01.urun_malzeme_adet %></strong> PCS </li>
                    </div>
              <% }) %>

            </ol>
           
          </div>
        </div>

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">LUVİNKA DT6001</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% luvinkaStockCard.forEach(DT6001 => { %>
                   
                    <div class="d-flex justify-content-between bg-primary mb-1  item-list">
                      <li class="list-group-item bg-primary text-white mb-1 p-2  item-list"><%= DT6001.urun_malzeme_adi %></li>
                      <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= DT6001.urun_malzeme_adet %></strong> PCS </li>
                    </div>
              <% }) %>

            </ol>
           
          </div>
        </div>

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">GZC24</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% gzc24StockCard.forEach(gzc24 => { %>
                    
                    <div class="d-flex justify-content-between bg-primary mb-1  item-list">
                      <li class="list-group-item bg-primary text-white mb-1 p-2  item-list"><%= gzc24.urun_malzeme_adi %></li>
                      <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= gzc24.urun_malzeme_adet %></strong> PCS </li>
                    </div>
              <% }) %>

            </ol>
           
          </div>
        </div>

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">GOLD</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% goldStockCard.forEach(gold => { %>
                    
                    <div class="d-flex justify-content-between bg-primary mb-1  item-list">
                      <li class="list-group-item bg-primary text-white mb-1 p-2  item-list"><%= gold.urun_malzeme_adi %></li>
                      <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= gold.urun_malzeme_adet %></strong> PCS </li>
                    </div>
              <% }) %>

            </ol>
           
          </div>
        </div>

        <div class="card" style="width: 100%;">
          
          <div class="card-body">
            <h3 class="card-title bg-warning p-2 rounded">CASUS</h3>
            
            <p class="card-text">MALZEME LİSTESİ</p>
            <ol class="urunMalzemeList">

              <% casusStockCard.forEach(casus => { %>
                    
                    <div class="d-flex justify-content-between bg-primary mb-1  item-list">
                      <li class="list-group-item bg-primary text-white mb-1 p-2  item-list"><%= casus.urun_malzeme_adi %></li>
                      <li class="list-group-item bg-primary text-white mb-1 p-2 bg-warning "><strong class="text-dark"><%= casus.urun_malzeme_adet %></strong> PCS </li>
                    </div>
              <% }) %>

            </ol>
           
          </div>
        </div>


          
      </div>
        
      
    </main>

    <script>

      document.addEventListener("DOMContentLoaded", async function() {
        try {
          const response = await fetch("/urun/card/trc01");
          const trc01CardUrun = await response.json();
          trc01CardUrun.forEach(trc01 => {

              const trc01Baslık = document.querySelector(".trc01_baslık2");
              trc01Baslık.innerHTML= `<p class="p-0 m-0">${trc01.urun_Name}</p>`;

             

              
          });
        } catch (error) {
          console.error('Veri alınamadı:', error);
        }




      
      });

      



    </script>

     <script>

      document.addEventListener("DOMContentLoaded", () => {
          const role = localStorage.getItem("role");
          const userAllowedPages = ["/liveScreen", "/urunList"];
          const currentPath = window.location.pathname;

          if (role === "user" && !userAllowedPages.includes(currentPath)) {
            alert("Bu sayfaya erişiminiz yok.");
            window.location.href = "/liveScreen";
          }

          // logoutBtn varsa event ekle
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", (e) => {
              e.preventDefault();
              localStorage.clear();
              window.location.href = "/login";
            });
          }

          const user = JSON.parse(localStorage.getItem("user"));
          if (user && user.expires < Date.now()) {
            localStorage.clear();
            alert("Oturum süresi doldu. Lütfen tekrar giriş yapınız.");
            window.location.href = "/login";
          }
      });

      //////////////////////////////////////////////////////////////////////////////

      document.addEventListener("DOMContentLoaded", () => {
          const userStr = localStorage.getItem("user");
          if (!userStr) {
            // user yoksa direk login
            window.location.href = "/login";
            return;
          }

          let user = null;
          try {
            user = JSON.parse(userStr);
          } catch (e) {
            // parse hatası olursa da login
            window.location.href = "/login";
            return;
          }

          // expires kontrolü
          if (!user.expires || user.expires < Date.now()) {
            localStorage.clear();
            window.location.href = "/login";
            return;
          }

          // role kontrolü
          if (user.role !== "admin" && user.role !== "user") {
            window.location.href = "/login";
            return;
          }

          // Tüm kontroller geçerse sayfada kal, gerekirse devam et
          console.log("Giriş doğrulandı:", user.username, user.role);
      });


      //////////////////////////////////////////////////////////////////////////////

      document.addEventListener("DOMContentLoaded", () => {
          const userStr = localStorage.getItem("user");
          if (!userStr) {
            // user yoksa direk login
            window.location.href = "/login";
            return;
          }

          let user = null;
          try {
            user = JSON.parse(userStr);
          } catch (e) {
            // parse hatası olursa da login
            window.location.href = "/login";
            return;
          }

          // expires kontrolü
          if (!user.expires || user.expires < Date.now()) {
            localStorage.clear();
            window.location.href = "/login";
            return;
          }

          // role kontrolü
          if (user.role !== "admin" && user.role !== "user") {
            window.location.href = "/login";
            return;
          }

          // Tüm kontroller geçerse sayfada kal, gerekirse devam et
          console.log("Giriş doğrulandı:", user.username, user.role);
      });



    </script>
  

</body>
</html>