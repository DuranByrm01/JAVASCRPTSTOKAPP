<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("../partials/meta") %>
    <title>STOK EKRANI</title>

    <style>
      body{
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
    </style>

</head>
<body class="bg-dark">

    <%- include("../partials/nav") %>

    <div class="   mt-3 d-flex align-items-center justify-content-center flex-wrap p-3 gap-3">

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">TRC60</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">TRC01</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center" >9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">GZC24</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">GOLD</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">LUVİNKA</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">CASUS</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card" style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">ETİLEN JENERATÖR</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>

        <div class="card"  style="width: 25rem;">
            <br>
            <div class="card-body">
              <h5 class="card-title bg-warning p-3 fs-3">ETİLEN SIVI</h5>
              
              <p class="bg-primary text-white p-3 fs-4 text-center ">9999</p>
            </div>
        </div>


    </div>


    <script>

      document.addEventListener("DOMContentLoaded", () => {
          const role = localStorage.getItem("role");
          const userAllowedPages = ["/liveScreen", "/urunList"];
          const currentPath = window.location.pathname;

          if (role === "user" && !userAllowedPages.includes(currentPath)) {
            alert("Bu sayfaya erişiminiz yok.");
            window.location.href = "/liveScreen";
          }

          // logoutBtn varsa event ekle
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", (e) => {
              e.preventDefault();
              localStorage.clear();
              window.location.href = "/login";
            });
          }

          const user = JSON.parse(localStorage.getItem("user"));
          if (user && user.expires < Date.now()) {
            localStorage.clear();
            alert("Oturum süresi doldu. Lütfen tekrar giriş yapınız.");
            window.location.href = "/login";
          }
      });


      //////////////////////////////////////////////////////////////////////////////

      document.addEventListener("DOMContentLoaded", () => {
          const userStr = localStorage.getItem("user");
          if (!userStr) {
            // user yoksa direk login
            window.location.href = "/login";
            return;
          }

          let user = null;
          try {
            user = JSON.parse(userStr);
          } catch (e) {
            // parse hatası olursa da login
            window.location.href = "/login";
            return;
          }

          // expires kontrolü
          if (!user.expires || user.expires < Date.now()) {
            localStorage.clear();
            window.location.href = "/login";
            return;
          }

          // role kontrolü
          if (user.role !== "admin" && user.role !== "user") {
            window.location.href = "/login";
            return;
          }

          // Tüm kontroller geçerse sayfada kal, gerekirse devam et
          console.log("Giriş doğrulandı:", user.username, user.role);
      });



    </script>


    
</body>
</html>